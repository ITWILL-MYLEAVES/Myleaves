<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
    layout:decorate="~{layout/mngr_base_layout}">
    
<main layout:fragment="mngrHome">
	<h1>공지사항 작성</h1>	
   	<div class="my-2 card">
		<div class="card-body">
			<div class="my-2">
				<label for="title" class="form-label">제목</label>
				<input id="title" name="title" type="text" required autofocus
						class="form-control"/>
			</div>
			<div class="my-2">
				<label for="content" class="form-label">내용</label>
				<textarea id="content" name="content" class="form-control" required></textarea>
			</div>
			<div class="my-2 form-check">
				<input class="form-check-input" type="checkbox" value=""
					id="fix"> <label class="form-check-label"
					for="fix">고정여부</label>
			</div>
			<div class="my-2 d-none">
				<label class="form-label" for="author">작성자</label>
				<!-- <input class="form-control" id="author"
                       type="text" name="author" th:value="${ #authentication.name }" /> -->
				<input class="form-control" id="author" type="text" name="author" />
			</div>				
			<div class="my-2">
				<form id="attachFileForm" class="d-none">
					<input type="file" id="fileInput" name="fileInput">
					<input type="hidden" name="afBundleId" id="afBundleId">
				</form>
				<input type="button" value="추가" id="af-add" class="btn btn-primary btn-sm">
				<table width="100%" border="0" id="attachFiles" class="mt10"></table>
			</div>
			
			<div class="d-grid gap-2 d-md-flex col-6 mx-auto justify-content-md-center">
				<a class="btn btn-primary" type="button" th:href="@{/mngr/notice/list}">목록</a>
				<a class="btn btn-primary" type="button" id="UpdateBtn">저장</a>
				<a class="btn btn-primary" type="button" id="deleteBtn">삭제</a>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		let afBundleArr = [];
		document.addEventListener('DOMContentLoaded', () => {
			let afAddBtn = document.querySelector('input#af-add');
			let fileInput = document.querySelector('input#fileInput');
			
			afAddBtn.addEventListener('click', (e) => {
				e.preventDefault();
				
				fileInput.click();
			});
			
			fileInput.addEventListener('click', (e) =>{
				if(fileInput.val() != '') {
					let data = new FormData($('#attachFileForm')[0]);
				}
			});
		})
		/* 
		$(document).ready(function() {
			
			// 첨부파일
			$('.af-btn-add').on('click',function(e){
				e.preventDefault();
				
				$('#fileInput').trigger('click');
			});
			
			$('input[name="fileInput"]').change(function() {
				if($('input[name="fileInput"]').val()!=''){
					var data = new FormData($('#attachFileForm')[0]);
					$.ajax({
						type:"POST",
						enctype: 'multipart/form-data',
						url: "/attach/file",
						data: data,
						processData: false,
						contentType: false,
				        cache: false,
				        timeout: 600000,
						success: function(res){
							$('.loading').hide();
							$('#fileInput').val('');
							let afRow = '';
							afRow += '<tr>';
							afRow += '<td class="w90"><a href="/download/attach/'+res.af.afId+'">'+res.af.fileNm+'</a></td>';
							afRow += '<td><input type="button" value="삭제" onClick="deleteFile(this)" class="btn btn-danger btn-sm"></td>';
							afRow += '</tr>';
							$('#attachFiles').append(afRow);
							afBundleArr.push(res.af);
						},
						error: function(xhr, status, error){
							$('.loading').hide();
							$('#fileInput').val('');
							alert('파일 업로드 오류: ' + xhr.responseJSON.message);
							console.log(xhr);
						}
					})
				}
			});
		} */
	</script>
</main>


	
</html>